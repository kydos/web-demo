// Generated by CoffeeScript 1.7.1
(function() {
  var $, Post, avatar, connectRuntime, createMyPost, createOtherPost, drQos, dwQos, postReader, postTopic, postWriter, processPost, root, runtime, server, z_;

  root = this;

  z_ = coffez;

  $ = jQuery;

  server = "ws://192.168.0.102:9999";

  runtime = new dds.runtime.Runtime();

  postTopic = new dds.Topic(0, "Post");

  drQos = new dds.DataReaderQos(dds.Reliability.Reliable);

  dwQos = new dds.DataWriterQos(dds.Reliability.Reliable);

  postReader = z_.None;

  postWriter = z_.None;

  avatar = "avatar" + Math.floor((Math.random() * 10000) + 1);

  createMyPost = function(post) {
    var what, who;
    who = post.name;
    what = post.msg;
    return "<li class=\"left clearfix\">\n  <span class=\"chat-img pull-right\">\n    <img src=\"http://placehold.it/50/FA6F57/fff&amp;text=ME\" alt=\"User Avatar\" class=\"img-circle\">\n  </span>\n  <div class=\"chat-body clearfix\">\n    <div class=\"header\">\n      <strong class=\"primary-font\">" + who + "</strong>\n      <small class=\"pull-right text-muted\">\n        <span class=\"glyphicon glyphicon-time\"></span>\n          some time ago...\n      </small>\n    </div>\n    <p>\n      " + what + "\n    </p>\n  </div>\n</li>";
  };

  createOtherPost = function(post) {
    var what, who;
    who = post.name;
    what = post.msg;
    return "<li class=\"left clearfix\">\n  <span class=\"chat-img pull-left\">\n    <img src=\"http://placehold.it/50/55C1E7/fff&amp;text=U\" alt=\"User Avatar\" class=\"img-circle\">\n  </span>\n  <div class=\"chat-body clearfix\">\n    <div class=\"header\">\n      <strong class=\"primary-font\">" + who + "</strong>\n      <small class=\"pull-right text-muted\">\n        <span class=\"glyphicon glyphicon-time\"></span>\n          some time ago...\n      </small>\n    </div>\n    <p>\n      " + what + "\n    </p>\n  </div>\n</li>";
  };

  Post = (function() {
    function Post(name, msg) {
      this.name = name;
      this.msg = msg;
    }

    return Post;

  })();

  processPost = function() {
    var msg, post;
    msg = $("#ChatMessage").val();
    post = new Post(avatar, msg);
    postWriter.map(function(dw) {
      return dw.write(post);
    });
    $("#ChatMessageList").append(createMyPost(post));
    return $("#ChatMessage").val("");
  };

  $("#ChatMessage").keyup(function(e) {
    if (e.keyCode === 13) {
      return processPost();
    }
  });

  $("#SendMsgButton").click(function(evt) {
    console.log("Send Button has been clicked");
    return processPost();
  });

  $("#SelectAvatarButton").click(function(evt) {
    var s;
    s = $("#AvatarName").val();
    if (s !== "") {
      return avatar = s;
    }
  });

  runtime.onconnect = function() {
    var dr, dw;
    dr = new dds.DataReader(runtime, postTopic, drQos);
    dw = new dds.DataWriter(runtime, postTopic, dwQos);
    dr.addListener(function(post) {
      if (post.name !== avatar) {
        return $("#ChatMessageList").append(createOtherPost(post));
      }
    });
    postReader = z_.Some(dr);
    return postWriter = z_.Some(dw);
  };

  connectRuntime = function() {
    $("#AvatarName").val(avatar);
    return runtime.connect(server, "uid:pwd");
  };

  $(document).ready(function() {
    return connectRuntime();
  });

}).call(this);

//# sourceMappingURL=web-chat.map
