(function(){var c,d,f,g,l,b,e,h;this.coffez={};l={map:function(a){return l},flatMap:function(a){return l},get:function(){},getOrElse:function(a){return a()},orElse:function(a){return a()},isEmpty:function(){return!0}};f=function(){function a(a){this.value=a}a.prototype.map=function(b){return new a(b(this.value))};a.prototype.flatMap=function(a){return a(this.value)};a.prototype.get=function(){return this.value};a.prototype.getOrElse=function(a){return this.value};a.prototype.orElse=function(a){return this};
a.prototype.isEmpty=function(){return!1};return a}();c=function(){function a(a){this.what=a}a.prototype.map=function(a){throw this.what;};a.prototype.flatMap=function(a){throw this.what;};a.prototype.get=function(){throw this.what;};a.prototype.getOrElse=function(a){throw this.what;};a.prototype.orElse=function(a){throw this.what;};a.prototype.isEmpty=function(){throw this.what;};return a}();g=function(){function a(a){this.value=a}a.prototype.map=function(a){return a(this.value)};a.prototype.get=
function(){return this.value};a.prototype.getOrElse=function(a){return this.value};a.prototype.orElse=function(a){return this};a.prototype.isFailure=function(){return!1};a.prototype.isSuccess=function(){return!0};a.prototype.toOption=function(){return new f(this.value)};a.prototype.recover=function(a){return this};return a}();d=function(){function a(a){this.exception=a}a.prototype.map=function(a){return l};a.prototype.get=function(){return this.exception};a.prototype.getOrElse=function(a){return a()};
a.prototype.orElse=function(a){return a()};a.prototype.isFailure=function(){return!0};a.prototype.isSuccess=function(){return!1};a.prototype.toOption=function(){return l};a.prototype.recover=function(a){return a(this.exception)};return a}();b=function(a,b){return void 0===b?!0:a===b};h=function(a,b){var n,d,r;r=!0;for(d in a)n=a[d],n=e(n,b[d]),r=r&&n;return r};e=function(a,d){switch(typeof a){case "object":switch(typeof d){case "object":return h(a,d);default:return!1}case "function":return!1;case "undefined":return!1;
default:switch(typeof d){case "object":return!1;case "function":return!1;case "undefined":return!0;default:return b(a,d)}}};this.coffez.None=l;this.coffez.Some=function(a){return new f(a)};this.coffez.Fail=function(a){return new c(a)};this.coffez.Success=function(a){return new g(a)};this.coffez.Failure=function(a){return new d(a)};this.coffez.match=e}).call(this);(function(){this.dds={};this.dds.runtime={};dds.runtime.controllerPath="/vortex/controller";dds.runtime.readerPrefixPath="/vortex/reader";dds.runtime.writerPrefixPath="/vortex/writer";dds.runtime.controllerURL=function(c){return c+dds.runtime.controllerPath};dds.runtime.readerPrefixURL=function(c){return c+dds.runtime.readerPrefixPath};dds.runtime.writerPrefixURL=function(c){return c+dds.runtime.writerPrefixPath}}).call(this);(function(){var c,d,f,g,l,b,e,h,a,k,n,v,r,w,t,s,x,H,u,y,z,A,I,B,C,D,E,m,p,q,F,G;e={OK:0,Error:1,Create:2,Connect:3,Disconnect:4,Close:5,Write:6,Log:7};p={Error:0,Connected:1,Disconnected:2,DataAvailable:3,Create:4};m={Topic:0,DataReader:1,DataWriter:2,Runtime:3,Worker:4};this.dds.runtime.EntityKind=m;this.dds.runtime.CommandId=e;this.dds.runtime.EventId=p;q=function(a,b){return{cid:a,kind:b}};h=q(e.Connect,m.Runtime);B=q(e.Disconnect,m.Runtime);I={h:B};d=q(e.Close,m.Runtime);c={h:d};l=function(a){return function(b,
u,x){return{h:a,topic:b,qos:u,eid:x}}};u=q(e.Create,m.Topic);H=l(u);t=q(e.Create,m.DataReader);w=l(t);g=q(e.Close,m.DataReader);f=l(g);x=q(e.Create,m.DataWriter);s=l(x);b=q(e.Close,m.DataWriter);l=l(b);this.dds.runtime.ConnectCmd=h;this.dds.runtime.Connect=function(a,b){return{h:h,url:a,authToken:b}};this.dds.runtime.DisconnectCmd=B;this.dds.runtime.Disconnect=I;this.dds.runtime.CloseCmd=d;this.dds.runtime.Close=c;this.dds.runtime.CreateTopicCmd=u;this.dds.runtime.CreateTopic=H;this.dds.runtime.CreateDataReaderCmd=
t;this.dds.runtime.CreateDataReader=w;this.dds.runtime.CreateDataWriterCmd=x;this.dds.runtime.CreateDataWriter=s;this.dds.runtime.CloseDataReaderCmd=g;this.dds.runtime.CloseDataReader=f;this.dds.runtime.CloseDataWriterCmd=b;this.dds.runtime.CloseDataWriter=l;k=q(e.Connect,m.DataWriter);F=q(e.Write,m.DataWriter);this.dds.runtime.ConnectDataWriterCmd=k;this.dds.runtime.ConnectDataWriter=function(a,b){return{h:k,url:a,eid:b}};this.dds.runtime.WriteDataCmd=F;this.dds.runtime.WriteData=function(a,b){return{h:F,
data:a,eid:b}};a=q(e.Connect,m.DataWriter);this.dds.runtime.ConnectDataReaderCmd=a;this.dds.runtime.ConnectDataReader=function(b,u){return{h:a,url:b,eid:u}};c=function(a,b){return{eid:a,kind:b}};r=c(p.Connected,m.Runtime);E=c(p.Disconnected,m.Runtime);y=c(p.Create,m.DataReader);n=c(p.Connected,m.DataReader);C=c(p.Disconnected,m.DataReader);z=c(p.Create,m.DataWriter);c(p.Create,m.DataWriter);v=c(p.Connected,m.DataWriter);D=c(p.Disconnected,m.DataWriter);d={h:c(p.Create,m.DataTopic)};A=c(p.DataAvailable,
m.DataReader);this.dds.runtime.ConnectedRuntimeEvt=r;this.dds.runtime.OnConnectedRuntime=function(a){return{h:r,url:a}};this.dds.runtime.DisconnectedRuntimeEvt=E;this.dds.runtime.OnDisconnectedRuntime=function(a){return{h:E,url:a}};this.dds.runtime.CreatedDataTopicEvt=y;this.dds.runtime.OnCreatedTopic=d;this.dds.runtime.CreatedDataReaderEvt=y;this.dds.runtime.OnCreatedDataReader=function(a,b){return{h:y,url:a,eid:b}};this.dds.runtime.ConnectedDataReaderEvt=n;this.dds.runtime.OnConnectedDataReader=
function(a,b){return{h:n,url:a,eid:b}};this.dds.runtime.DisconnectedDataReaderEvt=C;this.dds.runtime.OnDisconnectedDataReader=function(a,b){return{h:C,url:a,eid:b}};this.dds.runtime.CreatedDataWriterEvt=z;this.dds.runtime.OnCreatedDataWriter=function(a,b){return{h:z,url:a,eid:b}};this.dds.runtime.ConnectedDataWriterEvt=v;this.dds.runtime.OnConnectedDataWriter=function(a,b){return{h:v,url:a,eid:b}};this.dds.runtime.DisconnectedDataWriterEvt=D;this.dds.runtime.OnDisconnectedDataWriter=function(a,b){return{h:D,
url:a,eid:b}};this.dds.runtime.DataAvailableEvt=A;this.dds.runtime.OnDataAvailable=function(a,b){return{h:A,data:a,eid:b}};G=q(e.Log,m.Worker);this.dds.runtime.WriteLogCmd=G;this.dds.runtime.WriteLog=function(a,b){return{h:G,kind:a,msg:b}}}).call(this);(function(){var c,d,f,g=function(d,b){return function(){return d.apply(b,arguments)}};d=dds.runtime;f=coffez;c=function(){function c(){this.onRcvWorkerMessage=g(this.onRcvWorkerMessage,this);this.onSendWorkerMessage=g(this.onSendWorkerMessage,this);this.onCtrlWorkerMessage=g(this.onCtrlWorkerMessage,this);this.writeData=g(this.writeData,this);this.closeDataWriter=g(this.closeDataWriter,this);this.closeDataReader=g(this.closeDataReader,this);this.closeTopic=g(this.closeTopic,this);this.createTopic=
g(this.createTopic,this);this.createDataReader=g(this.createDataReader,this);this.createDataWriter=g(this.createDataWriter,this);this.connect=g(this.connect,this);this.generateEntityId=g(this.generateEntityId,this);this.eidCount=this.sn=0;this.drmap={};this.dwmap={};this.onconnect=function(b){};this.onclose=function(b){};this.ondisconnect=function(b){};this.closed=this.connected=!1;this.ctrlWorker=new Worker("js/control-link.js");this.sendWorker=new Worker("js/writer-link.js");this.rcvWorker=new Worker("js/reader-link.js");
this.ctrlWorker.onmessage=this.onCtrlWorkerMessage;this.sendWorker.onmessage=this.onSendWorkerMessage;this.rcvWorker.onmessage=this.onRcvWorkerMessage;this.server="disconnected"}c.prototype.generateEntityId=function(){var b;b=this.eidCount;this.eidCount+=1;return b};c.prototype.connect=function(b,e){var c;this.server=b;console.log("[dds-runtime]: connect("+this.server+")");if(!1===this.connected)return this.connected=!0,c=d.Connect(this.server,e),this.ctrlWorker.postMessage(c);throw"Runtime already Connected";
};c.prototype.disconnect=function(){this.connected&&(console.log("[dds-runtime]: disconnecting..."),this.connected=!1,this.ctrlWorker.postMessage(d.Disconnect),this.sendWorker.postMessage(d.Disconnect),this.rcvWorker.postMessage(d.Disconnect));return this.ondisconnect(this.server)};c.prototype.createDataWriter=function(b){console.log("Setup DataWriter: "+b.eid);this.dwmap[b.eid]=b;b=d.CreateDataWriter(b.topic,b.qos,b.eid);return this.ctrlWorker.postMessage(b)};c.prototype.createDataReader=function(b){console.log("Seettin up DR with eid = "+
b.eid);this.drmap[b.eid]=b;b=d.CreateDataReader(b.topic,b.qos,b.eid);return this.ctrlWorker.postMessage(b)};c.prototype.createTopic=function(b){};c.prototype.closeTopic=function(b){};c.prototype.closeDataReader=function(b){};c.prototype.closeDataWriter=function(b){};c.prototype.writeData=function(b,e){var c;c=Array.isArray(e)?e:[e];c=JSON.stringify(c);c=d.WriteData(c,b.eid);return this.sendWorker.postMessage(c)};c.prototype.onCtrlWorkerMessage=function(b){b=b.data;switch(!1){case !f.match(b.h,d.ConnectedRuntimeEvt):return console.log(">> Runtime Connected."),
this.onconnect(b);case !f.match(b.h,d.DisconnectedRuntimeEvt):return console.log(">> Runtime Disconnected."),this.ondisconnect(b);case !f.match(b.h,d.CreatedDataReaderEvt):return console.log("DataReader created with eid = "+b.eid),b=d.ConnectDataReader(b.url,b.eid),this.rcvWorker.postMessage(b);case !f.match(b.h,d.CreatedDataWriterEvt):return console.log("DataWriter created with eid = "+b.eid),b=d.ConnectDataWriter(b.url,b.eid),this.sendWorker.postMessage(b);case !f.match(b.h,d.WriteLogCmd):return console.log("Log["+
b.kind+"]: "+b.msg);default:return console.log("Driver received invalid command from CtrlWorker")}};c.prototype.onSendWorkerMessage=function(b){b=b.data;switch(!1){case !f.match(b.h,d.ConnectedDataWriterEvt):return this.dwmap[b.eid].onconnect(b);case !f.match(b.h,d.DisconnectedDataWriterEvt):return this.dwmap[b.eid].ondisconnect(b);case !f.match(b.h,d.WriteLogCmd):return console.log("Log["+b.kind+"]: "+b.msg);default:return console.log("Driver received invalid command from SendWorker")}};c.prototype.onRcvWorkerMessage=
function(b){b=b.data;switch(!1){case !f.match(b.h,d.ConnectedDataReaderEvt):this.drmap[b.eid].onconnect(b);break;case !f.match(b.h,d.DisconnectedDataReaderEvt):this.drmap[b.eid].ondisconnect(b);break;case !f.match(b.h,d.DataAvailableEvt):this.drmap[b.eid].onDataAvailable(b.data);break;case !f.match(b.h,d.WriteLogCmd):console.log("Log["+b.kind+"]: "+b.msg);break;default:console.log("Driver Received Invalid Command from ReceiveWorker")}return{close:function(b){return function(){}}(this),isConnected:function(b){return function(){return b.connected}}(this),
isClosed:function(b){return function(){return b.closed}}(this)}};return c}();dds.runtime.Runtime=c}).call(this);(function(){var c,d,f,g,l,b,e,h;importScripts("coffez.js","config.js","control-commands.js");g=this;h=coffez;d=dds.runtime;f={log:function(a){a=d.WriteLog(d.EntityKind.Worker,a);return g.postMessage(a)}};b={};e={};l=function(a,c){var n;n=new WebSocket(a);f.log("Created Websocket for DR at "+a);b[c]=n;e[c]=a;n.onopen=function(b){return function(b){f.log("DR Websocket is open");return g.postMessage(d.OnConnectedDataReader(a,c))}}(this);n.onclose=function(n){return function(n){f.log("DR Websocket is closed");
delete b[c];return g.postMessage(d.OnDisconnectedDataReader(a,c))}}(this);return n.onmessage=function(a){return function(a){a=d.OnDataAvailable(a.data,c);return g.postMessage(d.OnDataAvailable(a.data,c))}}(this)};c=function(){var a,c,d;d=[];for(a in b)c=b[a],c.close(),d.push(g.postMessage(OnDisconnectedDataReader(e[a],a)));return d};g.onmessage=function(a){a=a.data;switch(!1){case !h.match(a.h,d.ConnectDataReaderCmd):return f.log("Setting-up Socket for : "+a.eid+", at "+a.url),l(a.url,a.eid);case !h.match(a.h,
d.Disconnect):return c();default:return f.log("Reader Worker Received Unknown Command!")}}}).call(this);(function(){var c,d,f,g,l,b,e,h,a,k;importScripts("coffez.js","config.js","control-commands.js");a=this;k=coffez;e=dds.runtime;f=function(a,b,c){return{cid:a,ek:b,sn:c}};g=function(a,b,c){return{did:a,tn:b.tname,tt:b.ttype,qos:c.policies}};l=function(a,b){return function(c,d,e){return{h:f(a,b,c),b:g(d.did,d,e)}}};c=l(e.CommandId.Create,e.EntityKind.DataReader);d=l(e.CommandId.Create,e.EntityKind.DataWriter);h={log:function(b){b=e.WriteLog(e.EntityKind.Worker,b);return a.postMessage(b)}};b=new (function(){function a(){this.closed=
this.connected=!1;this.ctrlSock=this.socket=k.None;this.authToken=this.server="";this.sn=0;this.drmap={};this.dwmap={}}a.prototype.connect=function(a,b){var c,d;return!1===this.connected?(this.server=a,this.authToken=b,c=e.controllerURL(this.server)+"/"+this.authToken,h.log("Connecting to: "+c),this.ctrlSock=k.None,c=new WebSocket(c),d=k.Some(c),d.map(function(a){return function(b){return b.onopen=function(){var b;h.log("Connected to: "+a.server);a.ctrlSock=d;a.connected=!0;b=e.OnConnectedRuntime(a.server);
return postMessage(b)}}}(this)),d.map(function(a){return function(b){return b.onclose=function(b){h.log("The  "+a.server+" seems to have dropped the connection.");a.connected=!1;a.closed=!0;a.ctrlSock=k.None;return postMessage(e.OnDisconnectedRuntime(a.server))}}}(this)),d.map(function(a){return function(b){return b.onmessage=function(b){return a.handleMessage(b)}}}(this))):h.log("Warning: Trying to connect an already connected Runtime")};a.prototype.disconnect=function(){if(this.connected)return this.connected=
!1,this.ctrlSock.map(function(a){return a.close()}),this.crtSock=k._None};a.prototype.createDataReader=function(a,b,d){var e;a=c(this.sn,a,b);this.drmap[this.sn]=d;this.sn+=1;e=JSON.stringify(a);return this.ctrlSock.map(function(a){return a.send(e)})};a.prototype.createDataWriter=function(a,b,c){var e;a=d(this.sn,a,b);this.dwmap[this.sn]=c;this.sn+=1;e=JSON.stringify(a);return this.ctrlSock.map(function(a){return a.send(e)})};a.prototype.createTopic=function(a,b,c){};a.prototype.handleMessage=function(a){var b;
h.log("CtrlWorker Received messasge from server:"+a.data);a=JSON.parse(a.data);switch(!1){case !k.match(a.h,{cid:e.CommandId.OK,ek:e.EntityKind.DataReader}):return b=a.b.eid,b=e.readerPrefixURL(this.server)+"/"+b,h.log("sn = "+a.h.sn+", eid = "+this.drmap[a.h.sn]),b=e.OnCreatedDataReader(b,this.drmap[a.h.sn]),delete this.drmap[a.h.sn],postMessage(b);case !k.match(a.h,{cid:e.CommandId.OK,ek:e.EntityKind.DataWriter}):return b=a.b.eid,b=e.writerPrefixURL(this.server)+"/"+b,h.log("sn = "+a.h.sn+", eid = "+
this.dwmap[a.h.sn]),b=e.OnCreatedDataWriter(b,this.dwmap[a.h.sn]),delete this.dwmap[a.h.sn],postMessage(b);case !k.match(a.h,{cid:e.CommandId.OK,ek:e.EntityKind.Topic}):return b=e.OnCreatedTopic,postMessage(b);case !k.match(a.h,{cid:e.CommandId.Error,ek:void 0}):return b=OnError(a.h.ek,a.b.msg),postMessage(b);default:return h.log("ControlLink received invalid message from server")}};return a}());a.onmessage=function(a){a=a.data;h.log("CtrlWorker received cmd: "+JSON.stringify(a));switch(!1){case !k.match(a.h,
e.ConnectCmd):return h.log("[control-link]: cmd = Connect ("+a.url+")"),b.connect(a.url,a.authToken);case !k.match(a.h,e.CreateTopicCmd):return b.createTopic(a.topic,a.qos,a.eid);case !k.match(a.h,e.CreateDataReaderCmd):return h.log("CreateDataReader: "+a.eid),b.createDataReader(a.topic,a.qos,a.eid);case !k.match(a.h,e.CreateDataWriterCmd):return h.log("CreateDataWriter: "+a.eid),b.createDataWriter(a.topic,a.qos,a.eid);case !k.match(a.h,e.Disconnect):return b.disconnect();default:return h.log("Worker Received Unknown Command!")}}}).call(this);(function(){var c,d,f,g,l,b,e,h,a,k,n,v,r,w,t=[].slice,s=function(a,b){return function(){return a.apply(b,arguments)}};w=coffez;"undefined"!==typeof c?("undefined"!==typeof module&&module.exports&&(c=module.exports=dds),c.dds=dds):this.dds=dds;dds.VERSION="0.1.1";l={KeepAll:0,KeepLast:1};g={KeepAll:{id:0,k:l.KeepAll},KeepLast:function(a){return{id:0,k:l.KeepLast,v:a}}};a={Reliable:0,BestEffort:1};h={BestEffort:{id:1,k:a.BestEffort},Reliable:{id:1,k:a.Reliable}};d={Volatile:0,TransientLocal:1,Transient:2,
Persistent:3};c={Volatile:{id:d.Volatile},TransientLocal:{id:d.TransientLocal},Transient:{id:d.Transient},Persistent:{id:d.Persistent}};f=function(){function a(){var b;b=arguments[0];this.policies=(2<=arguments.length?t.call(arguments,1):[]).concat(b)}a.prototype.add=function(){var b;b=1<=arguments.length?t.call(arguments,0):[];return new a(this.policies.concat(b))};return a}();this.dds.HistoryKind=l;this.dds.History=g;this.dds.ReliabilityKind=a;this.dds.Reliability=h;this.dds.Partition=function(){var a;
a=arguments[0];return{id:2,vs:(2<=arguments.length?t.call(arguments,1):[]).concat(a)}};this.dds.DurabilityKind=d;this.dds.Durability=c;this.dds.TimeFilter=function(a){return{id:4,v:a}};this.dds.ContentFilter=function(a){return{id:3,v:a}};this.dds.DataReaderQos=f;this.dds.DataWriterQos=f;b=function(){return function(a){this.value=a}}();(function(){return function(a,b){this.key=a;this.value=b}})();e={id:0,injectType:function(a){a=new b(JSON.stringify(a));console.log("InjectedType = "+JSON.stringify(a));
return a},extractType:function(a){a=JSON.parse(a.value);console.log("Extracted Type = "+a);return a}};k={id:1,injectType:function(a){return a},extractType:function(a){return a}};r=[e,k];f=function(){return function(a,b,c){this.did=a;this.tname=b;this.ttype=c;void 0===this.ttype?(this.ttype="org.omg.dds.types.JSONTopicType",this.typeSupportId=e.id):this.typeSupportId=k.id}}();c=function(){function a(b,c,d){this.runtime=b;this.topic=c;this.qos=d;this.close=s(this.close,this);this.onDataAvailable=s(this.onDataAvailable,
this);this.removeListener=s(this.removeListener,this);this.resetStats=s(this.resetStats,this);this.handlers=[];this.onclose=function(){};this.closed=!1;this.onconnect=function(){};this.ondisconnect=function(){};this.connected=!1;this.eid=this.runtime.generateEntityId();this.runtime.createDataReader(this);this.receivedSamples=0;this.typeSupport=r[this.topic.typeSupportId]}a.prototype.resetStats=function(){return this.receivedSamples=0};a.prototype.addListener=function(a){var b;b=this.handlers.length;
this.handlers=this.handlers.concat(a);return b};a.prototype.removeListener=function(a){var b;b=this.handlers;return this.handlers=b.slice(0,a).concat(b.slice(a+1,b.length))};a.prototype.onDataAvailable=function(a){var b;this.receivedSamples+=1;b=this.typeSupport.extractType(JSON.parse(a));return this.handlers.forEach(function(a){return a(b)})};a.prototype.close=function(){console.log("Closing DR "+this);this.closed=!0;this.runtime.closeDataReader(this);return this.onclose()};return a}();d=function(){function a(b,
c,d){this.runtime=b;this.topic=c;this.qos=d;this.write=s(this.write,this);this.onclose=function(){};this.closed=!1;this.onconnect=function(){};this.ondisconnect=function(){};this.connected=!1;this.eid=this.runtime.generateEntityId();this.runtime.createDataWriter(this);this.typeSupport=r[this.topic.typeSupportId]}a.prototype.write=function(){var a;a=(1<=arguments.length?t.call(arguments,0):[]).map(function(a){return function(b){return a.typeSupport.injectType(b)}}(this));return this.runtime.writeData(this,
a)};a.prototype.close=function(){this.closed=!0;this.socket=new Fail("Invalid State Exception: Can't write on a closed DataWriter");this.runtime.closeDataWriterConnection(this);return this.onclose()};return a}();this.dds.Topic=f;this.dds.DataReader=c;this.dds.DataWriter=d;c=function(){function a(b,c){this.depth=b;this.cache=c;this.clear=s(this.clear,this);this.fold=s(this.fold,this);null!=this.cache===!1&&(this.cache={});this.listeners=[]}a.prototype.addListener=function(a,b){var c;void 0===c&&(c=
function(a){return!0});return this.listeners=this.listeners.concat({predicate:b,listener:a})};a.prototype.write=function(a,b){var c;c=this.cache[a];c=null!=c===!1?[b]:c.length<this.depth?c.concat(b):c.slice(1,c.lenght).concat(b);this.cache[a]=c;return this.listeners.forEach(function(a){if(!0===a.predicate(b))return a.listener(b)})};a.prototype.forEachN=function(a,b){var c,d,e,f;e=this.cache;f=[];for(c in e)d=e[c],f.push(d.slice(0,+(b-1)+1||9E9).forEach(a));return f};a.prototype.forEach=function(a){var b,
c,d,e;d=this.cache;e=[];for(b in d)c=d[b],e.push(c.forEach(a));return e};a.prototype.map=function(b){var c,d,e,f;d={};f=this.cache;for(c in f)e=f[c],d[c]=e.map(b);return new a(this.depth,d)};a.prototype.filter=function(a){var b,c,d,e,f,k,g,h;d={};h=this.cache;for(c in h){f=h[c];k=0;for(g=f.length;k<g;k++)b=f[k],a(f)&&(e=b);0!==e.length&&(d[c]=e)}return d};a.prototype.filterNot=function(a){return filter(function(b){return!a(b)})};a.prototype.read=function(){var a,b,c,d;b=[];d=this.cache;for(a in d)c=
d[a],b=b.concat(c);return b};a.prototype.readLast=function(){var a,b,c,d;b=[];d=this.cache;for(a in d)c=d[a],b.add(c[c.length(-1)]);return b};a.prototype.take=function(){var a,b,c,d;c=this.cache;this.cache=[];b=[];for(a in c)d=c[a],b=b.concat(d);return b};a.prototype.take=function(a){var b;b=this.cache[a];this.cache[a]=[];return void 0===b?w.None:new Some(b)};a.prototype.takeWithFilter=function(a){var b,c,d,e,f,k,g,h,l;d=[];l=this.cache;for(c in l){k=l[c];g=0;for(h=k.length;g<h;g++)b=k[g],a(b)&&(f=
b);g=0;for(h=k.length;g<h;g++)b=k[g],a(b)||(e=b);d=d.concat(f);this.cache[c]=e}return d};a.prototype.get=function(a){a=this.cache[a];return void 0===a?w.None:new Some(a)};a.prototype.getOrElse=function(a,b){var c;c=this.cache[a];return void 0===c?b():new Some(c)};a.prototype.fold=function(a){return function(b){return function(c){var d,e,f,k;e=a;k=b.cache;for(d in k)f=k[d],e+=f.reduceRight(c);return e}}(this)};a.prototype.clear=function(){return this.cache={}};return a}();this.dds.bind=function(a){return function(b,
c){return b.addListener(function(b){return Array.isArray(b)?b.forEach(function(b){return c.write(a(b),b)}):c.write(a(b),b)})}};this.dds.bindWithOnce=function(a){return function(b,c,d){var e;e=!1;return b.addListener(function(b){!1===e&&(d(c),e=!0);return Array.isArray(b)?b.forEach(function(b){return c.write(a(b),b)}):c.write(a(b),b)})}};this.dds.DataCache=c;d={Topic:0,DataReader:1,DataWriter:2};c={OK:0,Error:1,Create:2,Delegate:3,Unregister:4};n=function(a,b,c){return{cid:a,ek:b,sn:c}};v=function(a,
b,c){return{did:a,tn:b.tname,tt:b.ttype,qos:c.policies}};f=function(a,b){return function(c,d,e){c=n(a,b,c);d=v(d.did,d,e);return{h:c,b:d}}};this.dds.DSEntityKind=d;this.dds.DSCommandId=c;this.dds.createDataReaderCommand=f(c.Create,d.DataReader);this.dds.createDataWriterCommand=f(c.Create,d.DataWriter)}).call(this);(function(){var c,d,f,g,l,b,e,h;importScripts("coffez.js","config.js","control-commands.js");g=this;h=coffez;d=dds.runtime;f={log:function(a){a=d.WriteLog(d.EntityKind.Worker,a);return g.postMessage(a)}};b={};e={};l=function(a,c){var h;h=new WebSocket(a);f.log("Created Websocket for DW at "+a);b[c]=h;e[c]=a;h.onopen=function(b){return function(b){f.log("DW Writer Websocket is open");return g.postMessage(d.OnConnectedDataWriter(a,c))}}(this);return h.onclose=function(e){return function(e){f.log("DW Websocket is closed");
delete b[c];return g.postMessage(d.OnDisconnectedDataWriter(a,c))}}(this)};c=function(){var a,c,f;f=[];for(a in b)c=b[a],c.close(),f.push(g.postMessage(d.OnDisconnectedDataWriter(e[a],a)));return f};g.onmessage=function(a){var e;e=a.data;switch(!1){case !h.match(e.h,d.ConnectDataWriterCmd):return f.log("Setting-up Socket for DW : "+e.eid+", at "+e.url),l(e.url,e.eid);case !h.match(e.h,d.WriteDataCmd):a=b[e.eid];e=e.data;try{return a.send(e)}catch(g){return f.log("Exception while sending data"),f.log(JSON.stringify(g))}case !h.match(e.h,
d.Disconnect):return c();default:return f.log("Reader Worker Received Unknown Command!")}}}).call(this);
